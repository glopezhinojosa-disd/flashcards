<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>English ‚Ä¢ Vocabulary Set 1 (Wikimedia images)</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --card2:#0b1222; --text:#e5e7eb; --accent:#60a5fa; --muted:#9ca3af; --green:#86efac; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(160deg,#0b1020,#0f172a 40%,#0b1020 100%);color:var(--text);min-height:100vh;display:grid;grid-template-rows:auto auto 1fr auto}
    header,footer{padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    header h1{font-size:18px;margin:0;color:var(--accent)}
    .sub{font-size:12px;color:var(--muted)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    a.btn{color:var(--text);text-decoration:none;background:#1f2937;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:10px;font-size:14px}
    a.btn:hover{border-color:rgba(255,255,255,.18)}
    .wrap{display:grid;place-items:center;padding:18px}
    .card{width:min(980px,96vw);min-height:360px;perspective:1200px}
    .inner{position:relative;width:100%;min-height:360px;transition:transform .6s;transform-style:preserve-3d}
    .flipped .inner{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;display:grid;grid-template-columns:1fr 1.2fr;gap:18px;align-items:center;background:radial-gradient(1200px 600px at 20% 0%,var(--card),var(--card2));border:1px solid rgba(255,255,255,.06);border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,.45),inset 0 1px 0 rgba(255,255,255,.04);backface-visibility:hidden;padding: clamp(16px, 2.4vw, 28px)}
    .media{display:grid;place-items:center}
    .media img{max-width:100%;max-height:270px;border-radius:12px;border:1px solid rgba(255,255,255,.08);object-fit:cover}
    .content{text-align:center;padding:0 10px}
    .lead{font-size:13px;color:var(--muted);margin:0 0 6px}
    h2{font-size:clamp(28px,4.6vw,44px);margin:6px 0 10px}
    .pron{font-size:clamp(18px,3vw,22px);color:var(--green);margin:4px 0 10px}
    .meaning{font-size:clamp(18px,2.6vw,22px);margin:6px 0}
    .back{transform:rotateY(180deg)}
    .controls{margin:14px 0 0;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
    button{background:#1f2937;color:var(--text);border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:12px;font-size:15px;cursor:pointer;transition:transform .06s ease, background .2s, border-color .2s}
    button:hover{background:#243041;border-color:rgba(255,255,255,.14)}
    button:active{transform:translateY(1px)}
    .pill{font-size:13px;color:var(--muted);background:rgba(255,255,255,.05);padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.06)}
    .kbd{font-family:ui-monospace,Consolas,monospace;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:6px;color:#cbd5e1}
    footer{justify-content:center;font-size:12px;color:var(--muted)}
    figcaption{font-size:12px;color:var(--muted);margin-top:6px}
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <div class="toolbar">
      <a class="btn" href="english.html" id="backEnglish">‚Üê English Menu</a>
      <a class="btn" href="index.html">üè† Home</a>
      <h1>English ‚Ä¢ Vocabulary Set 1 (Wikimedia images)</h1>
      <span class="sub">Click the card to flip</span>
    </div>
    <div class="toolbar">
      <span class="pill"><span id="counter">Card 1 of 130</span></span>
    </div>
  </header>

  <section class="wrap">
    <div id="card" class="card">
      <div class="inner">
        <!-- FRONT = word only (no image) -->
        <section class="face front" id="front">
          <div class="content" style="grid-column:1 / -1">
            <p class="lead">Front</p>
            <h2 id="frontWord">Word</h2>
          </div>
        </section>

        <!-- BACK = meaning + (optional) image -->
        <section class="face back" id="back">
          <div class="media hidden" id="mediaBack">
            <img id="imgBack" alt=""/>
          </div>
          <div class="content">
            <p class="lead">Back</p>
            <div class="pron" id="pron">(pronunciaci√≥n)</div>
            <div class="meaning" id="meaningEs">Significado en espa√±ol</div>
            <figcaption id="imgCaption" aria-live="polite"></figcaption>
          </div>
        </section>
      </div>
    </div>

    <div class="controls">
      <button id="prevBtn" title="Previous (‚Üê)">‚üµ Prev</button>
      <button id="flipBtn" title="Flip (Space)">Flip</button>
      <button id="nextBtn" title="Next (‚Üí)">Next ‚ü∂</button>
      <button id="shuffleBtn" title="Shuffle cards">Shuffle</button>
      <span class="pill">Keys: <span class="kbd">‚Üê</span> <span class="kbd">Space</span> <span class="kbd">‚Üí</span></span>
    </div>
  </section>

  <footer>Images fetched from Wikimedia Commons via API ‚Ä¢ Only shown on the back</footer>

  <script>
    const PLACEHOLDER = "data:image/svg+xml;charset=utf-8," + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500"><rect width="100%" height="100%" fill="#111827"/></svg>');

    // 90 cards total (your expanded list from before)
    const cards = [
      /* ---------- +40 CONCRETE, NOT-TOO-EASY WORDS ---------- */
      /* Verbs (20) ‚Äì no images, just text side */
      {type:"verb", front:"Yell",    pron:"(yel)",        es:"gritar"},
      {type:"verb", front:"Gag", pron:"(gag)", es:"dar arcadas / asquearse", wikimediaQuery:"gag reflex medical diagram"},
      {type:"verb", front:"Gallop",  pron:"(g√°lop)",      es:"galopar"},
      {type:"verb", front:"Slide",   pron:"(esl√°id)",     es:"deslizar(se)"},
      {type:"verb", front:"Stumble", pron:"(st√≥m-bol)",   es:"tropezar"},
      {type:"verb", front:"Whisper", pron:"(w√≠sper)",     es:"susurrar"},
      {type:"verb", front:"Shove",   pron:"(shov)",       es:"empujar bruscamente"},
      {type:"verb", front:"Scrub",   pron:"(escr√≥b)",     es:"restregar / tallar"},
      {type:"verb", front:"Stir",    pron:"(st√©r)",       es:"revolver (comida)"},
      {type:"verb", front:"Peel",    pron:"(p√≠l)",        es:"pelar"},
      {type:"verb", front:"Fetch",   pron:"(fech)",       es:"ir por / traer"},
      {type:"verb", front:"Mend",    pron:"(mend)",       es:"remendar / arreglar"},
      {type:"verb", front:"Stack",   pron:"(st√°k)",       es:"apilar"},
      {type:"verb", front:"Sweep",   pron:"(su√≠p)",       es:"barrer"},
      {type:"verb", front:"Kneel",   pron:"(n√≠l)",        es:"arrodillarse"},
      {type:"verb", front:"Stretch", pron:"(estr√©ch)",    es:"estirarse"},
      {type:"verb", front:"Crawl",   pron:"(kr√≥l)",       es:"gatear / arrastrarse"},
      {type:"verb", front:"Blink",   pron:"(bl√≠nk)",      es:"parpadear"},
      {type:"verb", front:"Shrug",   pron:"(shrog)",      es:"encogerse de hombros"},
      {type:"verb", front:"Sip",     pron:"(sip)",        es:"beber a sorbos"},
      
      /* Nouns (20) ‚Äì with Wikimedia image keywords */
      {type:"noun", front:"Building", pron:"(b√≠lding)",  es:"edificio",    wikimediaQuery:"building city"},
      {type:"noun", front:"Church",   pron:"(ch√©rch)",   es:"iglesia",     wikimediaQuery:"church building"},
      {type:"noun", front:"Aunt",     pron:"(ant)",      es:"t√≠a",         wikimediaQuery:"aunt family woman"},
      {type:"noun", front:"Uncle",    pron:"(√≥ncol)",    es:"t√≠o",         wikimediaQuery:"uncle family man"},
      {type:"noun", front:"Ladder",   pron:"(l√°d-er)",   es:"escalera",    wikimediaQuery:"ladder tool"},
      {type:"noun", front:"Shovel",   pron:"(sh√≥vol)",   es:"pala",        wikimediaQuery:"shovel tool"},
      {type:"noun", front:"Bucket",   pron:"(b√≥ket)",    es:"cubeta/balde",wikimediaQuery:"bucket pail"},
      {type:"noun", front:"Bench",    pron:"(bench)",    es:"banca/banco", wikimediaQuery:"bench park"},
      {type:"noun", front:"Sidewalk", pron:"(s√°id-uok)", es:"banqueta/acera", wikimediaQuery:"sidewalk pavement"},
      {type:"noun", front:"Alley",    pron:"(√°li)",      es:"callej√≥n",    wikimediaQuery:"alley street"},
      {type:"noun", front:"Barn",     pron:"(barn)",     es:"granero",     wikimediaQuery:"barn farm"},
      {type:"noun", front:"Bridge",   pron:"(br√≠y)",     es:"puente",      wikimediaQuery:"bridge river"},
      {type:"noun", front:"Chimney",  pron:"(ch√≠m-ni)",  es:"chimenea",    wikimediaQuery:"chimney house"},
      {type:"noun", front:"Pillow",   pron:"(p√≠lo)",     es:"almohada",    wikimediaQuery:"pillow bed"},
      {type:"noun", front:"Blanket",  pron:"(bl√°nket)",  es:"cobija/manta",wikimediaQuery:"blanket bed"},
      {type:"noun", front:"Suitcase", pron:"(s√∫t-keis)", es:"maleta",      wikimediaQuery:"suitcase luggage"},
      {type:"noun", front:"Mailbox",  pron:"(m√©il-boks)",es:"buz√≥n",       wikimediaQuery:"mailbox"},
      {type:"noun", front:"Faucet",   pron:"(f√≥set)",    es:"grifo/llave", wikimediaQuery:"faucet tap"},
      {type:"noun", front:"Helmet",   pron:"(h√©lmet)",   es:"casco",       wikimediaQuery:"helmet safety"},
      {type:"noun", front:"Leash",    pron:"(l√≠sh)",     es:"correa (perro)", wikimediaQuery:"dog leash"},

      /* original 40 ... (unchanged) */
      {type:"verb", front:"Run",     pron:"(r√°n)",  es:"correr"},
      {type:"verb", front:"Eat",     pron:"(√≠t)",   es:"comer"},
      {type:"verb", front:"Go",      pron:"(g√≥u)",  es:"ir"},
      {type:"verb", front:"See",     pron:"(s√≠)",   es:"ver"},
      {type:"verb", front:"Speak",   pron:"(sp√≠k)", es:"hablar"},
      {type:"verb", front:"Read",    pron:"(r√≠d)",  es:"leer"},
      {type:"verb", front:"Write",   pron:"(r√°it)", es:"escribir"},
      {type:"verb", front:"Play",    pron:"(pl√©i)", es:"jugar"},
      {type:"verb", front:"Have",    pron:"(j√°v)",  es:"tener"},
      {type:"verb", front:"Do",      pron:"(d√∫)",   es:"hacer"},

      {type:"noun", front:"Book",    pron:"(b√∫k)", es:"libro",             wikimediaQuery:"book"},
      {type:"noun", front:"Table",   pron:"(t√©ibol)", es:"mesa",           wikimediaQuery:"table furniture"},
      {type:"noun", front:"House",   pron:"(j√°us)", es:"casa",             wikimediaQuery:"house home"},
      {type:"noun", front:"School",  pron:"(sk√∫l)", es:"escuela",          wikimediaQuery:"school classroom"},
      {type:"noun", front:"Friend",  pron:"(fr√©nd)", es:"amigo/amiga",     wikimediaQuery:"friendship students"},
      {type:"noun", front:"Teacher", pron:"(t√≠cher)", es:"maestro/a",      wikimediaQuery:"teacher classroom"},
      {type:"noun", front:"Water",   pron:"(u√≥ter)", es:"agua",            wikimediaQuery:"glass of water"},
      {type:"noun", front:"Food",    pron:"(f√∫d)", es:"comida",            wikimediaQuery:"meal food"},
      {type:"noun", front:"Car",     pron:"(k√°r)", es:"carro",             wikimediaQuery:"car vehicle"},
      {type:"noun", front:"Dog",     pron:"(d√≥g)", es:"perro",             wikimediaQuery:"dog pet"},

      {type:"verb", front:"Want",    pron:"(u√≥nt)", es:"querer"},
      {type:"verb", front:"Need",    pron:"(n√≠d)",  es:"necesitar"},
      {type:"verb", front:"Like",    pron:"(l√°ik)", es:"gustar"},
      {type:"verb", front:"Make",    pron:"(m√©ik)", es:"hacer/fabricar"},
      {type:"verb", front:"Take",    pron:"(t√©ik)", es:"tomar/ llevar"},
      {type:"verb", front:"Give",    pron:"(gu√≠v)", es:"dar"},
      {type:"verb", front:"Open",    pron:"(√≥upen)", es:"abrir"},
      {type:"verb", front:"Close",   pron:"(kl√≥us)", es:"cerrar"},
      {type:"verb", front:"Work",    pron:"(u√©rk)", es:"trabajar"},
      {type:"verb", front:"Study",   pron:"(st√°di)", es:"estudiar"},

      {type:"noun", front:"Chair",   pron:"(ch√©er)", es:"silla",           wikimediaQuery:"chair furniture"},
      {type:"noun", front:"Bed",     pron:"(b√©d)",   es:"cama",            wikimediaQuery:"bed bedroom"},
      {type:"noun", front:"Pen",     pron:"(p√©n)",   es:"pluma",           wikimediaQuery:"pen writing instrument"},
      {type:"noun", front:"Phone",   pron:"(f√≥n)",   es:"tel√©fono",        wikimediaQuery:"smartphone telephone"},
      {type:"noun", front:"Computer",pron:"(kompi√∫ter)", es:"computadora", wikimediaQuery:"laptop computer"},
      {type:"noun", front:"City",    pron:"(s√≠ti)",  es:"ciudad",          wikimediaQuery:"city skyline"},
      {type:"noun", front:"Street",  pron:"(str√≠t)", es:"calle",           wikimediaQuery:"street road"},
      {type:"noun", front:"Window",  pron:"(u√≠ndou)", es:"ventana",        wikimediaQuery:"window house"},
      {type:"noun", front:"Door",    pron:"(d√≥r)",   es:"puerta",          wikimediaQuery:"door entrance"},
      {type:"noun", front:"Family",  pron:"(f√°mili)", es:"familia",        wikimediaQuery:"family parents children"},

      /* +20 ADVANCED VERBS */
      {type:"verb", front:"Analyze",     pron:"(√°nalaiz)",  es:"analizar"},
      {type:"verb", front:"Compare",     pron:"(komp√©r)",   es:"comparar"},
      {type:"verb", front:"Conclude",    pron:"(konkl√∫d)",  es:"concluir"},
      {type:"verb", front:"Demonstrate", pron:"(d√©mons-tre√≠t)", es:"demostrar"},
      {type:"verb", front:"Determine",   pron:"(dit√©rmin)", es:"determinar"},
      {type:"verb", front:"Evaluate",    pron:"(iv√°lueit)", es:"evaluar"},
      {type:"verb", front:"Investigate", pron:"(inv√©stigueit)", es:"investigar"},
      {type:"verb", front:"Justify",     pron:"(y√∫stifai)", es:"justificar"},
      {type:"verb", front:"Predict",     pron:"(prid√≠kt)",  es:"predecir"},
      {type:"verb", front:"Summarize",   pron:"(s√≥mar√°iz)", es:"resumir"},
      {type:"verb", front:"Interpret",   pron:"(int√©rpret)", es:"interpretar"},
      {type:"verb", front:"Construct",   pron:"(konstr√≥kt)", es:"construir"},
      {type:"verb", front:"Categorize",  pron:"(c√°tigor√°iz)", es:"categorizar"},
      {type:"verb", front:"Infer",       pron:"(inf√©r)",    es:"inferir"},
      {type:"verb", front:"Synthesize",  pron:"(s√≠ntesaiz)", es:"sintetizar"},
      {type:"verb", front:"Collaborate", pron:"(kol√°bor-eit)", es:"colaborar"},
      {type:"verb", front:"Reflect",     pron:"(rifl√©kt)",  es:"reflexionar"},
      {type:"verb", front:"Revise",      pron:"(riv√°iz)",   es:"revisar / corregir"},
      {type:"verb", front:"Identify",    pron:"(aid√©ntifai)", es:"identificar"},
      {type:"verb", front:"Organize",    pron:"(√≥rgan√°iz)", es:"organizar"},

      /* +20 ACADEMIC/SCIENCE NOUNS (with images) */
      {type:"noun", front:"Evidence",    pron:"(√©videns)", es:"evidencia",          wikimediaQuery:"evidence proof"},
      {type:"noun", front:"Hypothesis",  pron:"(jaip√≥thesis)", es:"hip√≥tesis",      wikimediaQuery:"hypothesis science"},
      {type:"noun", front:"Experiment",  pron:"(eksp√©riment)", es:"experimento",    wikimediaQuery:"science experiment"},
      {type:"noun", front:"Sample",      pron:"(s√°mpl)",   es:"muestra",            wikimediaQuery:"sample laboratory"},
      {type:"noun", front:"Disease",     pron:"(dis√≠z)",   es:"enfermedad",         wikimediaQuery:"disease"},
      {type:"noun", front:"Fever",       pron:"(f√≠ver)",   es:"fiebre",             wikimediaQuery:"fever thermometer"},
      {type:"noun", front:"Microscope",  pron:"(m√°ikroskoup)", es:"microscopio",    wikimediaQuery:"microscope"},
      {type:"noun", front:"Laboratory",  pron:"(lab√≥ratori)", es:"laboratorio",     wikimediaQuery:"laboratory"},
      {type:"noun", front:"Vaccine",     pron:"(vaks√≠n)",  es:"vacuna",             wikimediaQuery:"vaccine vial"},
      {type:"noun", front:"Symptom",     pron:"(s√≠mtom)",  es:"s√≠ntoma",            wikimediaQuery:"symptom patient"},
      {type:"noun", front:"Conclusion",  pron:"(konkl√∫shon)", es:"conclusi√≥n",      wikimediaQuery:"conclusion decision"},
      {type:"noun", front:"Data",        pron:"(d√©ita)",   es:"datos",              wikimediaQuery:"data spreadsheet"},
      {type:"noun", front:"Graph",       pron:"(gr√°f)",    es:"gr√°fica",            wikimediaQuery:"bar graph chart"},
      {type:"noun", front:"Result",      pron:"(ris√≥lt)",  es:"resultado",          wikimediaQuery:"result outcome"},
      {type:"noun", front:"Scientist",   pron:"(s√°ientist)", es:"cient√≠fico/a",     wikimediaQuery:"scientist"},
      {type:"noun", front:"Environment", pron:"(env√°ironment)", es:"medio ambiente", wikimediaQuery:"environment nature"},
      {type:"noun", front:"Ecosystem",   pron:"(√≠kosistem)", es:"ecosistema",       wikimediaQuery:"ecosystem"},
      {type:"noun", front:"Community",   pron:"(komy√∫niti)", es:"comunidad",        wikimediaQuery:"community people"},
      {type:"noun", front:"Government",  pron:"(g√≥verment)", es:"gobierno",         wikimediaQuery:"government building"},
      {type:"noun", front:"Economy",     pron:"(ek√≥nomi)",  es:"econom√≠a",          wikimediaQuery:"economy finance"},

      /* +10 ACADEMIC PHRASES (no images) */
      {type:"phrase", front:"According to the text", pron:"(ac√≥rding tu de t√©kst)", es:"Seg√∫n el texto"},
      {type:"phrase", front:"Based on the passage",  pron:"(beist on de p√°sich)",  es:"Basado en el pasaje"},
      {type:"phrase", front:"As a result",           pron:"(√°s a ris√≥lt)",         es:"Como resultado"},
      {type:"phrase", front:"On the other hand",     pron:"(on di √≥der jand)",     es:"Por otro lado"},
      {type:"phrase", front:"In contrast to",        pron:"(in k√≥ntrast tu)",      es:"En contraste con"},
      {type:"phrase", front:"For instance",          pron:"(for √≠nstans)",         es:"Por ejemplo"},
      {type:"phrase", front:"Draw a conclusion",     pron:"(dr√≥ a konkl√∫shon)",    es:"Sacar una conclusi√≥n"},
      {type:"phrase", front:"Support your answer",   pron:"(sop√≥rt y√≥r √°nswer)",   es:"Justifica tu respuesta"},
      {type:"phrase", front:"Cause and effect",      pron:"(k√≥z and if√©kt)",       es:"Causa y efecto"},
      {type:"phrase", front:"Main idea",             pron:"(m√©in aid√≠a)",          es:"Idea principal"}
    ];

    // Cache for Wikimedia results by query
    const wmCache = new Map();

  async function fetchWikimediaThumb(query){
        const API = 'https://commons.wikimedia.org/w/api.php';
        
        // Words we don‚Äôt want in titles/categories
        const BAD = [
          'adult','nsfw','nude','nudity','sex','sexual','erotic','porn','fetish','kissing',
          'violence','blood','gore','weapon','gun','knife','alcohol','drugs','smoking'
        ];
        const GOOD_HINTS = ['icon','pictogram','clip art','svg','diagram','illustration'];
      
        const isBad = (s='') => BAD.some(w => s.toLowerCase().includes(w));
        const isGood = (s='') => GOOD_HINTS.some(w => s.toLowerCase().includes(w));
      
        async function searchOnce(q){
          // Step 1: search for File: pages
          const params1 = new URLSearchParams({
            action:'query', format:'json', origin:'*',
            list:'search', srsearch:q, srnamespace:'6', srlimit:'5'
          });
          const r1 = await fetch(API + '?' + params1.toString());
          if (!r1.ok) return null;
          const data1 = await r1.json();
          const hits = data1?.query?.search || [];
          if (!hits.length) return null;
      
          const titles = hits.map(h => h.title).join('|');
          // Step 2: fetch imageinfo + categories
          const params2 = new URLSearchParams({
            action:'query', format:'json', origin:'*',
            titles, prop:'imageinfo|categories',
            iiprop:'url', iiurlwidth:'700', cllimit:'50'
          });
          const r2 = await fetch(API + '?' + params2.toString());
          if (!r2.ok) return null;
          const data2 = await r2.json();
          const pages = Object.values(data2.query.pages || {});
      
          // Filter out unsafe
          const candidates = pages.filter(p => {
            const title = (p.title || '');
            if (isBad(title)) return false;
            const cats = (p.categories || []).map(c => c.title || '');
            if (cats.some(isBad)) return false;
            return p.imageinfo && p.imageinfo[0];
          });
      
          if (!candidates.length) return null;
      
          // Prefer ‚Äúsafe‚Äù hints like icon, diagram, etc.
          let best = candidates.find(p => isGood(p.title) || (p.categories||[]).some(c => isGood(c.title)));
          if (!best) best = candidates[0];
      
          const info = best.imageinfo[0];
          return { url: info.thumburl || info.url || null, title: best.title || '' };
        }
      
        // Try safer searches first
        const try1 = await searchOnce(query + ' icon');
        if (try1) return try1;
        const try2 = await searchOnce(query + ' diagram');
        if (try2) return try2;
        const try3 = await searchOnce(query + ' photo');
        if (try3) return try3;
      
        return { url: null, title: null };
      }
    
              return { url, title };
            } catch (e) {
              return { url: null, title: null };
            }
          }


    async function getImageForCard(c){
      // Prefer explicit query, otherwise try the word itself (except generic phrases)
      const query = c.wikimediaQuery || (c.type !== "phrase" ? (c.front + " photo") : null);
      if (!query) return { url: null, title: "" };
    
      const r = await fetchWikimediaThumb(query);
      if (r.url) return r;
      return { url: null, title: "" };
    }

    let order = [...cards.keys()];
    let idx = 0, flipped = false;

    const card = document.getElementById('card');
    const imgBack  = document.getElementById('imgBack');
    const mediaBack = document.getElementById('mediaBack');
    const frontWord = document.getElementById('frontWord');
    const pron = document.getElementById('pron');
    const meaningEs = document.getElementById('meaningEs');
    const counter = document.getElementById('counter');
    const caption = document.getElementById('imgCaption');

    async function render(){
      const c = cards[order[idx]];
      frontWord.textContent = c.front;
      pron.textContent = c.pron || "";
      meaningEs.textContent = c.es || "";
      counter.textContent = `Card ${idx+1} of ${order.length}`;

      // default: hide image box on back
      mediaBack.classList.add('hidden');
      imgBack.src = PLACEHOLDER;
      caption.textContent = '';

      const {url, title} = await getImageForCard(c);
      if (url){
        imgBack.src = url;
        mediaBack.classList.remove('hidden');
        caption.textContent = title ? ('Wikimedia: ' + title) : '';
      }
    }
    function flip(){ flipped=!flipped; card.classList.toggle('flipped', flipped); }
    function next(){ idx=(idx+1)%order.length; flipped=false; card.classList.remove('flipped'); render(); }
    function prev(){ idx=(idx-1+order.length)%order.length; flipped=false; card.classList.remove('flipped'); render(); }
    function shuffle(){ for(let i=order.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [order[i],order[j]]=[order[j],order[i]];} idx=0; flipped=false; card.classList.remove('flipped'); render(); }

    document.getElementById('flipBtn').addEventListener('click', flip);
    document.getElementById('nextBtn').addEventListener('click', next);
    document.getElementById('prevBtn').addEventListener('click', prev);
    document.getElementById('shuffleBtn').addEventListener('click', shuffle);
    card.addEventListener('click', flip);
    document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){e.preventDefault(); flip();} if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); });

    // Smart back button fallback
    fetch('english.html', {method:'HEAD'}).then(r=>{ if(!r.ok) document.getElementById('backEnglish').href='index.html'; }).catch(()=>{ document.getElementById('backEnglish').href='index.html'; });

    render();
  </script>
</body>
</html>
